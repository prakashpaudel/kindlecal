<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
  </head>
  <body>
    <h1>What games are on?</h1>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
      function printCalendar() {
        var calendarId = '2tkcrnabirpmof75jrp23q2fifrqn3c0@import.calendar.google.com';
        var apiKey = 'AIzaSyBikCXU-ISuQQnTkXey20K_T1m4YgEePlg';
        var userTimeZone = "Africa/Kampala";
  
        gapi.client.init({
          'apiKey': apiKey,
          'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
        }).then(function () {
          return gapi.client.calendar.events.list({
            'calendarId': calendarId,
            'timeZone': userTimeZone,
            'singleEvents': true,
            'timeMin': (new Date()).toISOString(), // gathers only events not happened yet
            'maxResults': 20,
            'orderBy': 'startTime'
          });
        }).then(function (response) {
          if (response.result.items) {
            var calendarRows = [];

            response.result.items.forEach(function(entry) {
              var startsAt = entry.start.dateTime
              calendarRows.push('<div>' + startsAt + ' ' + entry.summary + '</div>')
            });

            document.getElementById('calendar').innerHTML = calendarRows.join("");
          }
        }, function (reason) {
          console.log('Error: ' + reason.result.error.message);
        });
      };
  
      // Loads the JavaScript client library and invokes `start` afterwards.
      gapi.load('client', printCalendar);
    </script>
    <div id="calendar"></div>
  </body>
</html>
